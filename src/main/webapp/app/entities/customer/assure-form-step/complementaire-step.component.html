<p-card>
  <ng-template #header>
    <div class="section-header">
      <i class="pi pi-shield"></i>
      <span>Assurances Complémentaires</span>
      @if (validSize) {
        <p-button
          (click)="addTiersPayant()"
          pTooltip="Ajouter un tiers payant"
          severity="info"
          size="small"
          [rounded]="true"
          icon="pi pi-plus"
          type="button"
          class="ml-auto">
        </p-button>
      }
    </div>
  </ng-template>

  <form [formGroup]="editForm" name="editForm">
    <div class="complementaire-grid">
      @for (tiersPayant of editFormGroups.controls; track i; let i = $index) {
        <div formArrayName="tiersPayants" class="complementaire-card">
          <ng-container [formGroupName]="i">
            <div class="complementaire-card-header">
              <span class="complementaire-card-title">Assurance #{{ i + 1 }}</span>
              <p-button
                (click)="confirmRemove(i)"
                severity="danger"
                icon="pi pi-times"
                size="small"
                pTooltip="Supprimer"
                [rounded]="true"
                [text]="true"
                type="button">
              </p-button>
            </div>

            <div class="complementaire-card-body">
              <input formControlName="id" type="hidden" name="id" />

              <div class="form-grid-compact">
                <!-- Tiers-payant -->
                <div class="form-field form-field-full">
                  <label>Tiers-payant <span class="required">*</span></label>
                  <p-autoComplete
                    formControlName="tiersPayant"
                    [suggestions]="tiersPayants"
                    (completeMethod)="searchTiersPayant($event)"
                    (onSelect)="onSelectTiersPayant($event, i)"
                    [forceSelection]="true"
                    [minQueryLength]="minLength"
                    [dropdown]="true"
                    optionLabel="fullName"
                    placeholder="Taper pour rechercher"
                    [fluid]="true">
                  </p-autoComplete>
                </div>

                <!-- Numéro de sécurité -->
                <div class="form-field">
                  <label>Numéro de sécurité <span class="required">*</span></label>
                  <input
                    pInputText
                    pKeyFilter="alphanum"
                    formControlName="num"
                    class="w-full"
                    autocomplete="off" />
                </div>

                <!-- Taux -->
                <div class="form-field">
                  <label>Taux (%) <span class="required">*</span></label>
                  <input
                    pInputText
                    pKeyFilter="int"
                    formControlName="taux"
                    class="w-full"
                    autocomplete="off" />
                </div>

                <!-- Ordre -->
                <div class="form-field">
                  <label>Ordre <span class="required">*</span></label>
                  <p-select
                    formControlName="priorite"
                    [options]="catgories"
                    optionLabel="label"
                    optionValue="value"
                    [fluid]="true"
                    appendTo="body">
                  </p-select>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      }
    </div>
  </form>
</p-card>
<jhi-toast-alert #alert />
<p-confirmdialog />
