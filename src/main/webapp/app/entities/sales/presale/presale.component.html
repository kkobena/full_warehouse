
<div class="container-fluid">
  <div class="pharma-smart-content p-2">
    <p-toolbar>
      <ng-template #start>
        <div class="row">
          <div class="col">
            <p-select
              (onChange)="onTypeVenteChange()"
              [(ngModel)]="typeVenteSelected"
              [filter]="false"
              [options]="typeVentes"
              placeholder="Filtrer par critère"
               [fluid]="true"
            >
            </p-select>
          </div>

          <div class="col">
            <p-iconfield>
              <p-inputicon class="pi pi-search" />
              <input (keyup.enter)="onSearch()" pInputText placeholder="Taper pour rechercher" type="text" />
            </p-iconfield>
          </div>
        </div>
      </ng-template>
      <ng-template #end>
        <div>
          <p-button
            [routerLink]="['/sales', true, 'new']"
            icon="pi pi-plus"
            label="Nouvelle pré-vente"
            raised="true"
            severity="success"
            type="button"
          >
          </p-button>
        </div>
      </ng-template>
    </p-toolbar>
    <div class="mt-3 mb-3">
      <p-table
      [paginator]="true"
      [rowsPerPageOptions]="[10, 15, 20, 30, 50]"
      [rows]="10"
      [showCurrentPageReport]="true"
      [value]="sales"
      currentPageReportTemplate="Affichage de {first} à {last} sur {totalRecords} ventes"
      dataKey="id"
      selectionMode="single"
      [showGridlines]="true"
      class="pharma-table"
    >
      <ng-template #header>
        <tr class="pharma-table-head">
          <th style="width: 3%"></th>
          <th style="width: 10%">Référence</th>
          <th style="width: 8%">Nbre d'articles</th>
          <th style="width: 8%">Montant</th>
          <th style="width: 20%">Client</th>
          <th style="width: 20%">Vendeur</th>
          <th style="width: 20%">Caissier</th>
          <th style="width: 11%"></th>
        </tr>
      </ng-template>
      <ng-template #body let-expanded="expanded" let-sale>
        <tr>
          <td>
            <p-button
              [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
              [pRowToggler]="sale"
              [rounded]="true"
              [text]="true"
              type="button"
            />
          </td>
          <td>
            <span class="pharma-code">{{ sale.numberTransaction }}</span>
          </td>
          <td class="text-right">{{ sale.salesLines.length | number }}</td>
          <td class="text-right">
            <span class="pharma-total">{{ sale.salesAmount | number }}</span>
          </td>
          <td>
            <div class="pharma-entity-name">{{ sale.customer?.fullName }}</div>
          </td>
          <td>{{ sale.seller?.fullName }}</td>
          <td>{{ sale.cassier?.fullName }}</td>
          <td class="text-center">
            <div class="btn-group">
              <p-button
                [rounded]="true"
                [routerLink]="['/sales', sale.id, true, 'edit']"
                [text]="true"
                icon="pi pi-pencil"
                pTooltip="Editer"
                severity="success"
                size="small"
              >
              </p-button>

              <p-button
                (click)="confirmRemove(sale)"
                [rounded]="true"
                [text]="true"
                class="ml-2"
                icon="pi pi-trash"
                pButton
                pTooltip="Supprimer"
                severity="danger"
                size="small"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template #expandedrow let-elRow>
        <tr class="pharma-expanded-row">
          <td colspan="8">
            <div class="pharma-sub-table-card card">
              <div class="card-header bg-info text-white">
                <i class="pi pi-list"></i>
                LISTES DES PRODUITS
              </div>
              <div class="card-body">
                <p-table
                  [paginator]="true"
                  [rowsPerPageOptions]="[10, 15, 20, 30, 50]"
                  [rows]="10"
                  [showCurrentPageReport]="true"
                  [value]="elRow.salesLines"
                  currentPageReportTemplate="Affichage de {first} à {last} sur {totalRecords} produits"
                  dataKey="id"
                  selectionMode="single"
                >
                  <ng-template #header>
                    <tr class="pharma-table-head">
                      <th style="width: 5%">#</th>
                      <th style="width: 10%">CODE</th>
                      <th style="width: 44%">LIBELLE</th>
                      <th style="width: 8%">QTE.D</th>
                      <th style="width: 8%">QTE.S</th>
                      <th style="width: 9%">PU</th>
                      <th style="width: 10%">TOTAL</th>
                    </tr>
                  </ng-template>
                  <ng-template let-rowIndex="rowIndex" let-saleLine #body>
                    <tr [ngClass]="{ 'table-danger': saleLine.quantitySold < saleLine.quantityRequested }">
                      <td style="text-align: left">
                        <span class="pharma-row-number">{{ rowIndex + 1 }}</span>
                      </td>
                      <td>
                        <span class="pharma-code">{{ saleLine.code }}</span>
                      </td>
                      <td>
                        <div class="pharma-product-name">{{ saleLine.produitLibelle }}</div>
                      </td>
                      <td class="text-right">
                        <span class="pharma-qty-value">{{ saleLine.quantityRequested | number }}</span>
                      </td>
                      <td class="text-right">
                        <span class="pharma-qty-value">{{ saleLine.quantitySold | number }}</span>
                      </td>
                      <td class="text-right">
                        <span class="pharma-price">{{ saleLine.regularUnitPrice | number }}</span>
                      </td>
                      <td class="text-right">
                        <span class="pharma-total">{{ saleLine.salesAmount | number }}</span>
                      </td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table></div>
  </div>



</div>
<jhi-confirm-dialog #confirmDialog></jhi-confirm-dialog>
