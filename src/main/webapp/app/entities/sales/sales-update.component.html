<p-confirmDialog [style]="{width: '40vw'}" #deleteItem key="deleteItem" [baseZIndex]="10000">
    <p-footer>
        <button type="button" class="p-button-danger" pButton icon="pi pi-times" label="Non"
                (click)="deleteItem.reject()"></button>
        <button type="button" pButton icon="pi pi-check" label="Oui" (click)="deleteItem.accept()"></button>
    </p-footer>

</p-confirmDialog>

<p-confirmDialog [style]="{width: '40vw'}" #forcerStock key="forcerStock" [baseZIndex]="10000">
    <p-footer>
        <button type="button" class="p-button-danger" pButton icon="pi pi-times" label="Non"
                (click)="forcerStock.reject()"></button>
        <button type="button" pButton icon="pi pi-check" label="Oui" (click)="forcerStock.accept()"></button>
    </p-footer>

</p-confirmDialog>
<div class="card-group">
    <div class="card">
        <div class="card-header sale-card-header">TYPE VENTE</div>
        <div class="card-body sale-card">
            <p-selectButton [options]="naturesVentes" [(ngModel)]="naturesVente"
                            optionLabel="name"></p-selectButton>
        </div>
    </div>
    <div class="card">
        <div class="card-header sale-card-header">NATURE VENTE</div>
        <div class="card-body sale-card">
            <p-selectButton [options]="typePrescriptions" [(ngModel)]="typePrescription"
                            optionLabel="name"></p-selectButton>
        </div>

    </div>


    <div class="card">
        <div class="card-header sale-card-header">OPERATEUR</div>
        <div class="card-body sale-card">
            <ng-select autofocus="true" #user [items]="users" bindLabel="fullName" class="produitContainer"
                       placeholder="Sélectionner un opérateur"
                       [(ngModel)]="userSeller" [searchable]="false"
                       (keyup)="searchUser($event)"
                       (change)="onSelectUser(user)"
            >
            </ng-select>
        </div>
    </div>
    <div class="card bg-light">

        <div class="card-body sale-card">
            <p-button icon="pi pi-search" styleClass="p-button-secondary" label="VENTE EN ATTENTE"></p-button>

            <p-button icon="pi pi-times" styleClass="p-button-danger" label="RETOUR"></p-button>
        </div>
    </div>
</div>

<div class="card-group mt-1" *ngIf="showClientSearchCard">
    <div class="card " style="max-width:20rem;">
        <div class="card-header sale-card-header">
            RECHERCHE CLIENT
        </div>
        <div class="card-body sale-card">
        <span class="p-input-icon-left sale-p-input-icon-left">
    <i class="pi pi-search"></i>
    <input type="text" pInputText #clientSearchBox [(ngModel)]="clientSearchValue"
           placeholder="Taper pour rechercher un client" class="sale-p-inputtext">
</span></div>
    </div>
    <div class="card">
        <div class="card-header sale-card-header">
            {{clientBoxHeader}}
            <span class="float-right">
                        <button pButton pRipple icon="pi pi-pencil"
                                pTooltip="Modifier"
                                class="p-button-rounded p-button-success p-button-sm"></button>
                    </span>
        </div>
        <div class="card-body sale-card">
            <span class="col-sm-6 h6">KOBENA YEDONSEIH ELIORA</span>
            <span class="col-sm-6 h6">MATRICULE/SS: ************</span>
        </div>

    </div>
    <div class="card" *ngIf="showAyantDroitCard">
        <div class="card-header sale-card-header">
            AYANT DROIT <span class="float-right">
                        <button pButton pRipple icon="pi pi-pencil"
                                pTooltip="Modifier"
                                class="p-button-rounded p-button-success p-button-sm"></button>
                    </span>
        </div>
        <div class="card-body sale-card">
            <span class="col-sm-6 h6">KOBENA YEDONSEIH ELIORA</span>
            <span class="col-sm-6 h6">MATRICULE/SS: ************</span>
        </div>
    </div>
    <div class="card" *ngIf="showTiersPayantCard">
        <div class="card-header sale-card-header">
            TIERS-PAYANT <span class="float-right">
                        <button pButton pRipple icon="pi pi-plus"
                                pTooltip="Ajouter"
                                class="p-button-rounded p-button-primary p-button-sm"></button>
                    </span>
        </div>
        <div class="card-body sale-card">

        </div>
    </div>
</div>

<div class="row mt-1 bg-light">
    <div [class]="produitClass">
        <div class="col-9">
            <div class="p-inputgroup">

                <span class="p-inputgroup-addon">Produits</span>
                <ng-select id="produitBox" autofocus="true" #produitbox [items]="produits" bindLabel="libelle"
                           placeholder="Sélectionner un produit"
                           [(ngModel)]="produitSelected" [searchable]="true"
                           (keyup)="searchFn($event)"
                           [searchFn]="produitComponentSearch"
                           (change)="onSelect(produitbox)"
                >

                    <ng-template ng-option-tmp let-item="item" let-index="index">
                        <div *ngIf="item.totalQuantity>0">
                        <span
                            style="width:20%; display:inline-block">{{item.codeCip}}</span><span> {{item.libelle}}</span>
                            <span class="float-right">{{item.regularUnitPrice |number}}</span>
                        </div>
                        <div *ngIf="item.totalQuantity<=0">
                                <span class="stockless"
                                      style="width:20%; display:inline-block">{{item.codeCip}}</span><span
                            class="stockless"> {{item.libelle}}</span> <span
                            class="float-right stockless">{{item.regularUnitPrice |number}}</span>
                        </div>
                    </ng-template>


                </ng-select>

            </div>
        </div>
        <div class="col-3">
            <div class="p-inputgroup">
                <span class="p-inputgroup-addon">Qté</span>
                <input pInputText #quantyBox [(ngModel)]="quantiteSaisie" type="number"
                       (keyup.enter)="onQuantityBoxAction($event)"/>
            </div>
        </div>
    </div>

    <div [class]="rayonClass">
        RAYONS:
        <p-tag severity="warning">
            SANS EMPLACEMENT
        </p-tag>
    </div>
    <div class="col-1" *ngIf="showStock">
        STOCK:
        <p-tag [severity]="stockSeverity" [rounded]="true">{{100 |number}}</p-tag>

    </div>
    <div class="col-3" *ngIf="remiseProduits.length>0">
        <div class="p-inputgroup">
            <span class="p-inputgroup-addon">Remises</span>
            <p-dropdown [options]="remiseProduits" [(ngModel)]="remiseProduit" placeholder="Selectionner une remise"
                        optionLabel="valeur"></p-dropdown>
        </div>
    </div>
</div>
<p-divider></p-divider>
<div class="row">
    <div class="col-12 col-lg-9 col-sm-12 col-md-12 col-xl-9 sale-products-table mb-1">
        <p-table [value]="salesLines" dataKey="id" [paginator]="true" [rows]="5"
                 [showCurrentPageReport]="true"
                 currentPageReportTemplate="Affichage de {first} à {last} sur {totalRecords} produits"
                 [rowsPerPageOptions]="[5,8,10,20]" selectionMode="single">
            <ng-template pTemplate="caption">
                <span class="mr-lg-5">PRODUITS DE LA VENTE</span>

                <span class="p-input-icon-left">
    <i class="pi pi-search"></i>
    <input type="text" pInputText [(ngModel)]="tableSearchValue" placeholder="TAPEZ POUR FILTRER">
</span>

            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th style="width:5%">
                        #
                    </th>
                    <th style="width:10%">CODE</th>
                    <th style="width:44%">LIBELLE</th>
                    <th style="width:8%">QTE.D</th>
                    <th style="width:8%">QTE.S</th>
                    <th style="width:9%">PU</th>
                    <th style="width:10%">TOTAL</th>
                    <th style="width:6%"></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-saleLine let-rowIndex="rowIndex">
                <tr [ngClass]="{'table-danger':saleLine.quantitySold<saleLine.quantityRequested}">
                    <td style="text-align: left;">{{rowIndex + 1}}</td>
                    <td>{{saleLine.code}}</td>
                    <td>{{saleLine.produitLibelle}}</td>
                    <td pEditableColumn style="text-align: right;">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input style="width: 100px;" pInputText type="number"
                                       [(ngModel)]="saleLine.quantityRequested" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{saleLine.quantityRequested |number}}
                            </ng-template>
                        </p-cellEditor>

                    </td>
                    <td pEditableColumn style="text-align: right;">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input style="width: 100px;" pInputText type="number"
                                       [(ngModel)]="saleLine.quantitySold" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{saleLine.quantitySold |number}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td pEditableColumn *ngIf="canUpdatePu;else unEditRegularUnitPrice" style="text-align: right;">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input style="width: 100px;" pInputText type="number"
                                       [(ngModel)]="saleLine.regularUnitPrice" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{saleLine.regularUnitPrice |number}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <ng-template #unEditRegularUnitPrice>
                        <td style="text-align: right;">{{saleLine.regularUnitPrice |number}}</td>
                    </ng-template>

                    <td style="text-align: right; font-weight: bold;">{{saleLine.salesAmount |number}}</td>
                    <td style="text-align: right;">
                        <button pButton pRipple icon="pi pi-trash"
                                pTooltip="Supprimer" (click)="confirmDeleteItem(saleLine)"
                                class="p-button-rounded p-button-danger p-button-sm  p-mb-3"></button>
                    </td>
                </tr>

            </ng-template>
            <ng-template pTemplate="footer">
                <tr>
                    <td colspan="2" class="p-text-left">TATAUX</td>
                    <td>5 Produits</td>
                    <td style="text-align: right">10</td>
                    <td style="text-align: right">10</td>
                    <td style="text-align: right">10</td>
                    <td style="text-align: right">10</td>
                    <td></td>
                </tr>
            </ng-template>
        </p-table>
    </div>
    <div class="col-12 col-lg-3 col-sm-12 col-md-12 col-xl-3 bg-light mb-1">
        <ul class="list-group mt-1">
            <li class="list-group-item"><span class="h6">TOTAL VENTE</span> <span
                class="float-right sale-amount text-success">{{10000|number}} Fca</span></li>
            <li class="list-group-item"><span class="h6">TOTAL TVA</span><span
                class="float-right sale-amount ">{{10000|number}} Fca</span></li>
            <li class="list-group-item"><span class="h6">TOTAL REMISE</span><span
                class="float-right sale-amount ">{{10000|number}} Fca</span></li>
            <li class="list-group-item"><span class="h6">PAR TIER-PAYANT</span><span
                class="float-right sale-amount ">{{10000|number}} Fca</span></li>
            <li class="list-group-item"><span class="h6">NET A PAYER</span><span
                class="float-right sale-amount text-danger ">{{10000|number}} Fca</span></li>
            <li class="list-group-item"><span class="h6">DERNIERE MONNAIE</span><span
                class="float-right sale-amount text-info">{{10000|number}} Fca</span></li>
            <li class="list-group-item"><span class="h6">MONNAIE</span><span
                class="float-right sale-amount text-info">{{10000|number}} Fca</span></li>
            <li class="list-group-item">
                <p-button icon="pi pi-search" styleClass="p-button-danger" label="TERMINER"></p-button>

                <p-button icon="pi pi-times" styleClass="p-button-secondary" label="EN ATTENTE"></p-button>
            </li>
        </ul>

    </div>
</div>
<div class="card-group">
    <div class="card" *ngIf="showModeReglementCard">
        <div class="card-header sale-card-header">MODE REGLEMENT <span class="float-right"><p-inputSwitch
            [(ngModel)]="isDiffere" (onChange)="onDiffereChange($event)">

        </p-inputSwitch></span><span class="float-right mr-1">Est-elle une différé ?</span></div>
        <div class="card-body sale-card">
            <p-selectButton [multiple]="true" [options]="modeReglements" [(ngModel)]="modeReglementSelected"
                            optionLabel="libelle" optionValue="code" (onChange)="onModeReglementChange($event)"

            ></p-selectButton>
        </div>
    </div>
    <div class="card" *ngIf="showModeReglementCard">
        <div class="card-header sale-card-header">FORMULAIRE DE REGLEMENT</div>
        <div class="card-body sale-card">
            <div [ngClass]="reglementInputParentClass">
                <div [ngClass]="reglementInputClass" *ngIf="montantCashDiv">
                    <span class="p-inputgroup-addon">CASH</span>
                    <input pInputText #montantCashInput [(ngModel)]="montantCash" type="number"/>
                </div>
                <div [ngClass]="reglementInputClass" *ngIf="montantOrangeDiv">
                    <span class="p-inputgroup-addon">OM</span>
                    <input pInputText #montantOMInput [(ngModel)]="montantOrange" type="number"/>
                </div>
                <div [ngClass]="reglementInputClass" *ngIf="montantMtnDiv">
                    <span class="p-inputgroup-addon">MTN</span>
                    <input pInputText #montantMTNInput [(ngModel)]="montantMtn" type="number"/>

                </div>
                <div [ngClass]="reglementInputClass" *ngIf="montantMoovDiv">
                    <span class="p-inputgroup-addon">MOOV</span>
                    <input pInputText #montantMOOVInput [(ngModel)]="montantMoov" type="number"/>
                </div>
                <div [ngClass]="reglementInputClass" *ngIf="montantWaveDiv">
                    <span class="p-inputgroup-addon">WAVE</span>
                    <input pInputText #montantWAVEInput [(ngModel)]="montantWave" type="number"/>
                </div>
                <div [ngClass]="reglementInputClass" *ngIf="montantCbDiv">
                    <span class="p-inputgroup-addon">CB</span>
                    <input pInputText #montantCbInput [(ngModel)]="montantCb" type="number"/>
                </div>
                <div [ngClass]="reglementInputClass" *ngIf="montantVirementDiv">
                    <span class="p-inputgroup-addon">VIREMENT</span>
                    <input pInputText #montantVirInput [(ngModel)]="montantVirement" type="number"/>
                </div>
                <div [ngClass]="reglementInputClass" *ngIf="montantChequeDiv">
                    <span class="p-inputgroup-addon">CHEQUE</span>
                    <input pInputText #montantChInput [(ngModel)]="montantCheque" type="number"/>
                </div>
            </div>

        </div>
    </div>
    <div class="card" *ngIf="showInfosComplementaireReglementCard">
        <div class="card-header sale-card-header">INFORMATIONS COMPLEMENTAIRES</div>
        <div class="card-body sale-card">
            <div class="p-inputgroup" *ngIf="isDiffere">
                <span class="p-inputgroup-addon">Téléphone</span>
                <input pInputText #telephoneDiffInput [(ngModel)]="telephone" type="text"/>
            </div>
            <div class="p-inputgroup mt-1" *ngIf="isDiffere">
                <span class="p-inputgroup-addon">Commentaire</span>
                <input pInputText #commentiareDiffInput [(ngModel)]="commentaire" type="text"/>
            </div>
            <div class="row mt-1" *ngIf="showInfosBancaire">
                <div class="p-inputgroup col-6">
                    <span class="p-inputgroup-addon">Référence</span>
                    <input pInputText #referenceInput [(ngModel)]="referenceBancaire" type="text"/>
                </div>
                <div class="p-inputgroup  col-6">
                    <span class="p-inputgroup-addon">Banque</span>
                    <input pInputText #banqueInput [(ngModel)]="banque" type="text"/>
                </div>
                <div class="p-inputgroup mt-1  col-8">
                    <span class="p-inputgroup-addon">Lieux</span>
                    <input pInputText #lieuxInput [(ngModel)]="lieux" type="text"/>
                </div>
            </div>
        </div>
    </div>

</div>




