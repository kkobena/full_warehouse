<jhi-confirm-dialog #confirmDialog></jhi-confirm-dialog>

<div class="container-fluid">
  <div class="row">
    <div class="col-lg-2 col-xl-2 col-xxl-2  col-md-3 col-sm-4">
      <!-- Modern Navigation Sidebar -->
      <div class="pharma-nav-sidebar">
        <div class="pharma-nav-sidebar-card">
          <div class="pharma-nav-sidebar-header">
            <i class="pi pi-box"></i>
            <span>Gestion commandes</span>
          </div>

          <div class="pharma-nav-sidebar-content">
            <div
              #nav="ngbNav"
              (navChange)="onNavChange($event)"
              [(activeId)]="active"
              class="nav flex-column nav-pills"
              ngbNav
              orientation="vertical"
            >

              <ng-container ngbNavItem="REQUESTED">
                <a class="pharma-nav-vertical-link" ngbNavLink>
                  <i class="pi pi-spin pi-spinner"></i>
                  <span>Commande en cours</span>
                  <span class="link-arrow">›</span>
                </a>
                <ng-template ngbNavContent>
                  <jhi-commande-en-cours
                    (selectionLength)="updateSelectionLength($event)"
                    [searchCommande]="searchCommande"
                    [search]="search"
                  ></jhi-commande-en-cours>
                </ng-template>
              </ng-container>

              <ng-container ngbNavItem="BONS_EN_COURS">
                <a class="pharma-nav-vertical-link" ngbNavLink>
                  <i class="pi pi-fw pi-truck"></i>
                  <span>Bons en cours</span>
                  <span class="link-arrow">›</span>
                </a>
                <ng-template ngbNavContent>
                  <jhi-bon-en-cours [search]="search"></jhi-bon-en-cours>
                </ng-template>
              </ng-container>

              <ng-container ngbNavItem="LIST_BONS">
                <a class="pharma-nav-vertical-link" ngbNavLink>
                  <i class="pi pi-list"></i>
                  <span>Liste des bons</span>
                  <span class="link-arrow">›</span>
                </a>
                <ng-template ngbNavContent>
                  <jhi-list-bons [search]="search"></jhi-list-bons>
                </ng-template>
              </ng-container>
              <ng-container ngbNavItem="SUGGESTIONS">
                <a class="pharma-nav-vertical-link" ngbNavLink>
                  <i class="pi pi-lightbulb"></i>
                  <span>Suggestions</span>
                  <span class="link-arrow">›</span>
                </a>
                <ng-template ngbNavContent>
                  <jhi-suggestion
                    (selectionLength)="updateSelectionLength($event)"
                    [fournisseurId]="selectFournisseurId"
                    [selectedtypeSuggession]="selectedtypeSuggession"
                  ></jhi-suggestion>
                </ng-template>
              </ng-container>

              <ng-container ngbNavItem="RETOUR_FOURNISSEUR">
                <a class="pharma-nav-vertical-link" ngbNavLink>
                  <i class="pi pi-replay"></i>
                  <span>Retours fournisseur</span>
                  <span class="link-arrow">›</span>
                </a>
                <ng-template ngbNavContent>
                  <jhi-retour-bon-list></jhi-retour-bon-list>
                </ng-template>
              </ng-container>

            </div>
          </div>
        </div>
      </div>

    </div>
    <div class="col-lg-10 col-xl-10 col-xxl-10  col-md-9 col-sm-8">
      <div class="pharma-smart-content p-2">
        <!-- Modern Pharma Toolbar -->
        <div class="pharma-toolbar">
          <div class="pharma-toolbar-header">
            <i [ngClass]="icon"></i>
            <span class="pharma-toolbar-title">{{title}}</span>
          </div>

          <p-toolbar>
            <ng-template #start>
              <div class="pharma-toolbar-filters">
                @if (active === 'REQUESTED') {
                  <div class="pharma-search-input mr-2">
                    <p-iconfield>
                      <p-inputicon class="pi pi-search" />
                      <input
                        (keyup.enter)="onSearch()"
                        [(ngModel)]="searchCommande"
                        pInputText
                        placeholder="Recherche sur la commande"
                        type="text"
                      />
                    </p-iconfield>
                  </div>
                }

                <div class="pharma-search-input mr-2">
                  <p-iconfield>
                    <p-inputicon class="pi pi-search" />
                    <input
                      (keyup.enter)="onSearch()"
                      [(ngModel)]="search"
                      pInputText
                      placeholder="Taper pour rechercher"
                      type="text"
                    />
                  </p-iconfield>
                </div>

                @if (active === 'SUGGESTIONS') {
                  <p-select
                    (onChange)="onTypeSuggestionChange($event)"
                    [filter]="false"
                    [showClear]="true"
                    [options]="typeSuggessions"
                    optionLabel="label"
                    optionValue="value"
                    placeholder="Séléctionner un type de suggestion"
                    appendTo="body"
                    class="mr-2"
                  />

                  <p-select
                    (onChange)="onFournisseurChange($event)"
                    [filter]="false"
                    [showClear]="true"
                    [options]="fournisseurs"
                    optionLabel="libelle"
                    optionValue="id"
                    placeholder="Séléctionner un fournisseur"
                    appendTo="body"
                    class="mr-2"
                  />
                }
              </div>
            </ng-template>

            <ng-template #end>
              <div class="pharma-toolbar-actions">
                <div class="pharma-button-group">
                  <p-button
                    (click)="onSearch()"
                    [raised]="true"
                    icon="pi pi-search"
                    label="Rechercher"
                    pTooltip="Rechercher"
                    severity="info"
                    tooltipPosition="top"
                    type="button"
                  />

                  @if (active === 'REQUESTED') {
                    <p-button
                      (click)="onShowNewCommandeDialog()"
                      [raised]="true"
                      icon="pi pi-upload"
                      label="Importation"
                      pTooltip="Importation"
                      severity="help"
                      tooltipPosition="top"
                      type="button"
                    />

                    <p-button
                      (click)="onCreatNewCommande()"
                      [raised]="true"
                      icon="pi pi-plus"
                      label="Nouvelle commande"
                      pTooltip="Nouvelle commande"
                      severity="primary"
                      tooltipPosition="top"
                      type="button"
                    />
                  }

                  @if (active === 'RETOUR_FOURNISSEUR') {
                    <p-button
                      (click)="onCreateRetourFournisseur()"
                      [raised]="true"
                      icon="pi pi-plus"
                      label="Nouveau retour"
                      pTooltip="Créer un nouveau retour fournisseur"
                      severity="primary"
                      tooltipPosition="top"
                      type="button"
                    />
                  }

                  @if ((active === 'REQUESTED' || active === 'SUGGESTIONS') && selectionLength > 1) {
                    <p-button
                      (click)="fusionner()"
                      [raised]="true"
                      icon="pi pi-copy"
                      label="Fusionner"
                      pTooltip="Fusionner"
                      severity="warn"
                      tooltipPosition="top"
                      type="button"
                    />
                  }

                  @if (selectionLength > 0 && active !== 'RECEIVED') {
                    <p-button
                      (click)="confirmDeleteSelectedRows()"
                      [raised]="true"
                      icon="pi pi-times"
                      label="Supprimer"
                      pTooltip="Supprimer"
                      severity="danger"
                      tooltipPosition="top"
                      type="button"
                    />
                  }
                </div>
              </div>
            </ng-template>
          </p-toolbar>
        </div>

        <div class="mt-3" [ngbNavOutlet]="nav"></div>
      </div>
    </div>
  </div>

</div>


