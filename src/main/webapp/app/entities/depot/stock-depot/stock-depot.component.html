<jhi-toast-alert #alert></jhi-toast-alert>

<div class="container-fluid">
  <div class="pharma-smart-content p-2">
    <!-- Modern Pharma Toolbar (Compact) -->
    <div class="pharma-toolbar">
      <div class="pharma-toolbar-header">
        <i class="pi pi-box"></i>
        <span class="pharma-toolbar-title">Produits</span>
      </div>

      <p-toolbar>
        <ng-template #start>
          <div class="pharma-toolbar-filters">
            <p-select
              id="depots"
              (onChange)="onSelectDepot()"
              [(ngModel)]="selectedDepot"
              [appendTo]="'body'"
              [dataKey]="'id'"
              size="large"
              [options]="depots"
              [placeholder]="'Sélectionner un dépôt'"
              [style]="{ 'min-width': '200px' }"
              class="pharma-select-modern"
              optionLabel="name">
              <ng-template #item let-depot>
                <div class="depot-option">
                  <div class="depot-name">{{ depot.name }}</div>
                  @if (depot.address) {
                    <div class="depot-address"
                         style="font-size: 0.85rem; color: #6c757d;">{{ depot.address }}
                    </div>
                  }
                </div>
              </ng-template>
            </p-select>

            <div class="pharma-compact-search">
              <p-iconfield>
                <p-inputicon class="pi pi-search" />
                <input (keyup.enter)="onSearch($event)" pInputText placeholder="Rechercher..."
                       type="text" />
              </p-iconfield>
            </div>
          </div>
        </ng-template>

        <ng-template #end>

          <div class="pharma-toolbar-actions">
            <p-button
              [raised]="true"
              [routerLink]="['/depot',  'new-vente']"
              icon="pi pi-shopping-cart"
              label="Nouvelle vente"
              severity="primary"
            />
            <p-button
              (click)="onOpenImportDialog()"
              icon="pi pi-upload"
              label="Importation"
              severity="help"
            ></p-button>

            <p-button
              [routerLink]="['/depot', 'new-return']"
              icon="pi pi-undo"
              label="Retour dépôt"
              severity="warn"
            ></p-button>

          </div>

        </ng-template>
      </p-toolbar>
    </div>

    <div class="mt-2">

        <p-table  [value]="produits" class="pharma-table"
                 dataKey="id">
          <ng-template #header>
            <tr class="pharma-table-head">
              <th style="width: 8%">Cip</th>
              <th style="width: 11%">Code EAN</th>
              <th style="width: 24%"><span
                jhiTranslate="warehouseApp.produit.libelle">Libelle</span>
              </th>
              <th style="text-align: right; width: 6%"><span
                jhiTranslate="warehouseApp.produit.quantity">Quantity</span></th>

              <th style="text-align: right; width: 8%"><span
                jhiTranslate="warehouseApp.produit.costAmount">Prix achat </span></th>
              <th style="text-align: right; width: 8%"><span
                jhiTranslate="warehouseApp.produit.regularUnitPrice">Regular Unit Price</span></th>

            </tr>
          </ng-template>
          <ng-template #body let-produit>
            <tr>

              <td>
                <span class="pharma-code">{{ produit.codeCip }}</span>
              </td>
              <td>
                <span class="pharma-code">{{ produit.codeEan }}</span>
              </td>
              <td>
                <div class="pharma-product-name">{{ produit.libelle }}</div>
              </td>
              @if (produit.totalQuantity < 0) {
                <td class="amount-column red-400"
                    style="text-align: right">{{ produit.totalQuantity | number }}
                </td>
              } @else if (produit.totalQuantity === 0) {
                <td class="amount-column orange-400"
                    style="text-align: right">{{ produit.totalQuantity | number }}
                </td>
              } @else {
                <td class="amount-column"
                    style="text-align: right">{{ produit.totalQuantity | number }}
                </td>
              }

              <td style="text-align: right">
                <span class="pharma-price">{{ produit.costAmount | number }}</span>
              </td>
              <td style="text-align: right">
                <span class="pharma-price">{{ produit.regularUnitPrice | number }}</span>
              </td>

            </tr>
          </ng-template>


          <ng-template #emptymessage>
            <tr>
              <td colspan="10" class="pharma-empty-message">
                <div class="pharma-empty-content">
                  <i class="pi pi-inbox"></i>
                  <p>Aucune donnée trouvée</p>
                  <small>Sélectionner un dépôt pour afficher ses produits</small>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
        <div class="mt-2">
          <div class="d-flex justify-content-center">
            <ngb-pagination
              (pageChange)="loadPage($event)"
              [(page)]="ngbPaginationPage"
              [boundaryLinks]="true"
              [collectionSize]="totalItems"
              [maxSize]="5"
              [pageSize]="itemsPerPage"
              [rotate]="true"
            ></ngb-pagination>
          </div>
        </div>

    </div>
  </div>
</div>
<jhi-confirm-dialog #confirmDialog></jhi-confirm-dialog>


