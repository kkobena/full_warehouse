<p-table
  *ngIf="deliveries && deliveries.length > 0"

  [lazy]="true" [loading]="loading"
  [paginator]="true"
  [rowExpandMode]="rowExpandMode"
  [rowsPerPageOptions]="[5,10,15,20,30,50]"
  [rows]="itemsPerPage" [showCurrentPageReport]="false"
  [totalRecords]="totalItems"
  [value]="deliveries"
  dataKey="id"
  selectionMode="multiple"
  styleClass="p-datatable-gridlines mt-2">
  <ng-template pTemplate="header">
    <tr>
      <th style="width:1%"></th>
      <th style="width:6%">#</th>
      <th style="width:13%">Date</th>
      <th style="width:8%">Date reception</th>
      <th style="width:9%">Num.Bl</th>
      <th style="width:8%">Montant TTC</th>
      <th style="width:8%">Montant HT</th>
      <th style="width:8%">Taxe</th>
      <th style="width:7%">Nbre d'articles</th>

      <th style="width:13%">Fournisseur</th>
      <th style="width:12%">Opérateur</th>

      <th style="width:7%"></th>
    </tr>
  </ng-template>
  <ng-template let-expanded="expanded" let-row pTemplate="body">
    <tr>
      <td>
        <!-- <button [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
                 [pRowToggler]="row" class="p-button-text p-button-rounded p-button-plain"
                 pButton
                 pRipple
                 type="button"></button>-->
        <p-button [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'" [pRowToggler]="row" [rounded]="true" [text]="true" pRipple
                  type="button" />
      </td>
      <td>{{ row.numberTransaction }}</td>
      <td>{{ row.createdDate |date: 'dd/MM/yyyy HH:mm:ss' }}</td>
      <td>{{ row.receiptDate |date: 'dd/MM/yyyy' }}</td>
      <td>{{ row.receiptRefernce }}</td>

      <td class="text-right">{{ row.receiptAmount |number }}</td>
      <td class="text-right">{{ row.netAmount |number }}</td>
      <td class="text-right">{{ row.taxAmount |number }}</td>

      <td class="text-right">{{ row.itemSize |number }}</td>
      <td>{{ row.fournisseurLibelle }}</td>
      <td>{{ row.modifiedUser }}</td>

      <td class="text-right">
        <div class="btn-group">
          @if (row.statut === 'PENDING0') {
            <button [rounded]="true" severity="success"
                    pButtonIcon="pi pi-pencil" pButton
                    pRipple pTooltip="Editer">

            </button>
          }

          @if (row.statut === 'PENDING') {
            <button [routerLink]="['/commande', row.id, 'stock-entry']"
                    pButtonIcon="pi pi-upload"
                    pButton
                    severity="help"
                    [rounded]="true"
                    pRipple
                    pTooltip="Faire l'entréé en  stock"></button>
          }

          <button (click)="exportPdf(row)"
                  [rounded]="true"
                  pButton
                  pButtonIcon="pi pi-file-pdf"
                  pRipple
                  pTooltip="Imprimer" severity="warn"></button>

        </div>
      </td>
    </tr>
  </ng-template>
  <ng-template let-item pTemplate="rowexpansion">
    <tr>
      <td colspan="12">
        <div class="p-3">
          <p-table [paginator]="true" [rowsPerPageOptions]="[10,25,50]" [rows]="10"
                   [showCurrentPageReport]="false"
                   [value]="item.receiptItems"
          >
            <ng-template pTemplate="header">
              <tr>
                <th>#</th>
                <th pSortableColumn="fournisseurProduitCip">Code
                  <p-sortIcon field="fournisseurProduitCip"></p-sortIcon>
                </th>
                <th pSortableColumn="fournisseurProduitLibelle">Libellé
                  <p-sortIcon field="fournisseurProduitLibelle"></p-sortIcon>
                </th>
                <th>Stock.Init
                </th>
                <th>Stock.final
                </th>
                <th>Qté.Livrée
                </th>
                <th>Prix.Achat
                </th>
                <th>Prix.Vente
                </th>
              </tr>
            </ng-template>
            <ng-template let-receiptItem let-rowIndex="rowIndex" pTemplate="body">
              <tr>
                <td style="text-align: left;">{{ rowIndex + 1 }}</td>
                <td> {{
                    receiptItem.fournisseurProduitEan || receiptItem.fournisseurProduitCip
                  }}
                </td>
                <td> {{ receiptItem.fournisseurProduitLibelle }}</td>
                <td class="text-right">{{ receiptItem.initStock |number }}</td>
                <td class="text-right">{{ receiptItem.afterStock |number }}</td>
                <td class="text-right">{{ receiptItem.quantityReceived |number }}</td>
                <td class="text-right">{{ receiptItem.orderCostAmount |number }}</td>
                <td class="text-right">{{ receiptItem.orderUnitPrice |number }}</td>
              </tr>
            </ng-template>
          </p-table>
        </div>

      </td>
    </tr>
  </ng-template>
</p-table>



