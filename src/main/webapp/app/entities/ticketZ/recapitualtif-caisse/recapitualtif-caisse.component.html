<div class="pharma-smart-content p-2">
  <!-- Modern Pharma Toolbar (Compact) -->
  <div class="pharma-toolbar pharma-toolbar-compact">
    <div class="pharma-toolbar-header">
      <i class="pi pi-calculator"></i>
      <span class="pharma-toolbar-title">Récapitulatif de caisse</span>
    </div>

    <p-toolbar>
      <ng-template #start>
        <div class="pharma-toolbar-filters">
          <p-select size="large" (onChange)="onSelectedUsersChange()" [(ngModel)]="onlyVente" [options]="mvts" appendTo="body" />

          <p-multiSelect
            [(ngModel)]="selectedUsersId"
            size="large"
            [options]="users"
            id="selectedUserId"
            inputId="selectedUserId"
            optionLabel="abbrName"
            optionValue="id"
            appendTo="body"
          />

          <p-floatlabel variant="on">
            <p-datePicker
              [style]="{ 'max-width': '140px' }"
              [(ngModel)]="fromDate"
              [maxDate]="toDate"
              [selectOtherMonths]="true"
              [showButtonBar]="true"
              dateFormat="dd/mm/yy"
              id="fromDate"
              inputId="fromDate"
              appendTo="body"
            />
            <label for="fromDate">Du</label>
          </p-floatlabel>

          <p-floatlabel variant="on">
            <p-datePicker
              [style]="{ 'max-width': '140px' }"
              [(ngModel)]="toDate"
              [minDate]="fromDate"
              [selectOtherMonths]="true"
              [showButtonBar]="true"
              dateFormat="dd/mm/yy"
              id="toDate"
              inputId="toDate"
              appendTo="body"
            />
            <label for="toDate">Au</label>
          </p-floatlabel>

          <p-floatlabel variant="on" class="pharma-hide-mobile">
            <p-select [(ngModel)]="fromTime" [options]="hous" id="fromHour" size="large" appendTo="body" />
            <label for="fromHour">De</label>
          </p-floatlabel>

          <p-floatlabel variant="on" class="pharma-hide-mobile">
            <p-select [(ngModel)]="toTime" [options]="hous" id="toHour" size="large" appendTo="body" />
            <label for="toHour">À</label>
          </p-floatlabel>
        </div>
      </ng-template>

      <ng-template #end>
        <div class="pharma-toolbar-actions">
          <div class="pharma-button-group">
            <p-button
              (onClick)="fetchTickets()"
              [raised]="true"
              icon="pi pi-file"
              label="Rechercher"
              pTooltip="Rechercher"
              severity="primary"
              tooltipPosition="top"
            />

            <p-splitbutton
              [model]="messageBtn"
              [raised]="true"
              icon="pi pi-telegram"
              label="Message"
              pTooltip="Envoie par mail ou SMS"
              severity="info"
              tooltipPosition="top"
            />

            <p-splitbutton
              [model]="exportMenus"
              [raised]="true"
              icon="pi pi-file-export"
              label="Exporter"
              pTooltip="Imprimer ou exporter en PDF"
              severity="help"
              tooltipPosition="top"
            />
          </div>
        </div>
      </ng-template>
    </p-toolbar>
  </div>
  <div class="mt-3 mb-3 pharma-smart row">
    @let summary = ticketZ?.summaries || [];
    @if (summary.length) {
      <div class="col-3 summary">
        <p-card>
          <ng-template #title>
            <div class="card-title primary-title">
              <i class="pi pi-money-bill mr-2"></i>
              RECAPITULATIF GÉNÉRAL
            </div>
          </ng-template>
          <div class="grid">
            <div class="col-12">
              @for (item of summary; track item.libelle) {
                <div class="field">
                  <label class="fw-semibold fs-4"> {{ item.libelle }}</label>
                  <span class="badge text-bg-secondary fs-4 rounded-pill">{{ item.value | number }}</span>
                </div>
              }
            </div>
          </div>
        </p-card>
      </div>
    }
    <div [ngClass]="summary.length ? 'col-9 row' : 'col-12 row'">
      @for (recap of ticketZ?.datas; track recap.userName) {
        <div class="col mb-1">
          <p-card>
            <ng-template #title>
              <div class="card-title secondary-title">
                <i class="pi pi-money-bill mr-2"></i>
                {{ 'RECAPITULATIF DE: ' + recap.userName }}
              </div>
            </ng-template>
            <div class="grid">
              <div class="col-12">
                @for (item of recap.datas; track item.libelle) {
                  <div class="field">
                    <label> {{ item.libelle }}</label>
                    <span class="badge text-bg-secondary fs-5 rounded-pill">{{ item.value | number }}</span>
                  </div>
                }
                @for (item of recap.summary; track item.libelle) {
                  <div class="field">
                    <label class="fw-semibold fs-4"> {{ item.libelle }}</label>
                    <span class="badge text-bg-secondary fs-4 rounded-pill">{{ item.value | number }}</span>
                  </div>
                }
              </div>
            </div>
          </p-card>
        </div>
      }
    </div>
  </div>
</div>

<jhi-spinner #spinner></jhi-spinner>
