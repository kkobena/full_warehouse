@if (deliveries && deliveries.length > 0) {
  <p-table
    [lazy]="true"
    [loading]="loading"
    [paginator]="true"
    (onLazyLoad)="lazyLoading($event)"
    [rowExpandMode]="rowExpandMode"
    [rowsPerPageOptions]="[5, 10, 15, 20, 30, 50]"
    [rows]="itemsPerPage"
    [showCurrentPageReport]="true"
    [totalRecords]="totalItems"
    [value]="deliveries"
    currentPageReportTemplate="Affichage de {first} à {last} sur {totalRecords} elements"
    dataKey="id"
    selectionMode="multiple"
    [stripedRows]="true"
    class="pharma-table mt-2"
  >
    <ng-template #header>
      <tr class="pharma-table-head">
        <th style="width: 1%"></th>
        <th style="width: 13%">Date</th>
        <th style="width: 8%">Date reception</th>
        <th style="width: 9%">Num.Bl</th>
        <th style="width: 8%">Montant TTC</th>
        <th style="width: 8%">Montant HT</th>
        <th style="width: 8%">Taxe</th>
        <th style="width: 7%">Nbre d'articles</th>

        <th style="width: 13%">Fournisseur</th>
        <th style="width: 12%">Opérateur</th>

        <th style="width: 7%"></th>
      </tr>
    </ng-template>
    <ng-template let-expanded="expanded" let-row #body>
      <tr>
        <td>
          <p-button
            [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
            [pRowToggler]="row"
            [rounded]="true"
            [text]="true"
            type="button"
          />
        </td>

        <td>{{ row.createdDate | date: 'dd/MM/yyyy HH:mm:ss' }}</td>
        <td>{{ row.receiptDate | date: 'dd/MM/yyyy' }}</td>
        <td>
          <span class="pharma-code">{{ row.receiptReference }}</span>
        </td>

        <td class="text-right amount-td-column">
          <span class="pharma-total">{{ row.receiptAmount | number }}</span>
        </td>
        <td class="text-right amount-td-column">
          <span class="pharma-total">{{ row.netAmount | number }}</span>
        </td>
        <td class="text-right amount-td-column">
          <span class="pharma-total">{{ row.taxAmount | number }}</span>
        </td>

        <td class="text-right amount-td-column">{{ row.itemSize | number }}</td>
        <td>
          <div class="pharma-entity-name">{{ row.fournisseurLibelle }}</div>
        </td>
        <td>{{ row.createdUser }}</td>

        <td class="text-right">
          <div class="btn-group">
            @if (row.statut === 'PENDING0') {
              <p-button [text]="true" icon="pi pi-pencil" severity="success" [rounded]="true"
                        pTooltip="Editer"></p-button>
            }


            <p-button
              [text]="true"
              (click)="exportPdf(row)"
              [rounded]="true"
              class="ml-sm-1"
              icon="pi pi-file-pdf"
              pTooltip="Imprimer"
              severity="warn"
              size="small"
            ></p-button>
            <p-button
              [text]="true"
              (click)="printEtiquette(row)"
              [rounded]="true"
              class="ml-sm-1"
              icon="pi pi-print"
              pTooltip="Imprimer étiquettes"
              severity="secondary"
              size="small"
            ></p-button>
          </div>
        </td>
      </tr>
    </ng-template>
    <ng-template #expandedrow let-item>
      <tr class="pharma-expanded-row">
        <td colspan="12">
          <div class="pharma-sub-table-container">
            <div class="pharma-sub-table-header">
              <i class="pi pi-list"></i>
              <span>DÉTAILS DU BON DE LIVRAISON</span>
            </div>
            <div class="pharma-sub-table-body">
            <p-table
              [paginator]="true"
              [rowsPerPageOptions]="[10, 25, 50]"
              [rows]="10"
              [showCurrentPageReport]="true"
              [value]="item.receiptItems"
              currentPageReportTemplate="Affichage de {first} à {last} sur {totalRecords} elements"
            >
              <ng-template #header>
                <tr class="pharma-table-head">
                  <th>#</th>
                  <th pSortableColumn="fournisseurProduitCip">
                    Code
                    <p-sortIcon field="fournisseurProduitCip"></p-sortIcon>
                  </th>
                  <th pSortableColumn="fournisseurProduitLibelle">
                    Libellé
                    <p-sortIcon field="fournisseurProduitLibelle"></p-sortIcon>
                  </th>
                  <th>Stock.Init</th>
                  <th>Stock.final</th>
                  <th>Qté.Livrée</th>
                  <th>Prix.Achat</th>
                  <th>Prix.Vente</th>
                </tr>
              </ng-template>
              <ng-template let-receiptItem let-rowIndex="rowIndex" #body>
                <tr>
                  <td style="text-align: left">
                    <span class="pharma-row-number">{{ rowIndex + 1 }}</span>
                  </td>
                  <td>
                    <span class="pharma-code">{{
                      receiptItem.fournisseurProduitEan || receiptItem.fournisseurProduitCip
                    }}</span>
                  </td>
                  <td>
                    <div class="pharma-product-name">{{ receiptItem.fournisseurProduitLibelle }}</div>
                  </td>
                  <td class="text-right">
                    <span class="pharma-qty-value">{{ receiptItem.initStock | number }}</span>
                  </td>
                  <td class="text-right">
                    <span class="pharma-qty-value">{{ receiptItem.afterStock | number }}</span>
                  </td>
                  <td class="text-right">
                    <span class="pharma-qty-value">{{ receiptItem.quantityReceived | number }}</span>
                  </td>
                  <td class="text-right">
                    <span class="pharma-price">{{ receiptItem.orderCostAmount | number }}</span>
                  </td>
                  <td class="text-right">
                    <span class="pharma-price">{{ receiptItem.orderUnitPrice | number }}</span>
                  </td>
                </tr>
              </ng-template>
            </p-table>
            </div>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
}
<jhi-spinner #spinner></jhi-spinner>
