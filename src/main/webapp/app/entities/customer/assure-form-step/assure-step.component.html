<form [formGroup]="editForm" name="editForm">
  <input formControlName="id" id="id" name="id" type="hidden" />

  <!-- Two Column Layout for Main Sections -->
  <div class="card-grid-2col">
    <!-- Section 1: Champs Obligatoires -->
    <p-card>
      <ng-template #header>
        <div class="section-header section-header-required">
          <i class="pi pi-exclamation-circle"></i>
          <span>Champs Obligatoires</span>
        </div>
      </ng-template>

      <div class="form-grid-compact">
        <!-- Nom -->
        <div class="form-field form-field-full">
          <label for="field_firstName">Nom <span class="required">*</span></label>
          <input
            #firstName
            pInputText
            id="field_firstName"
            formControlName="firstName"
            class="w-full"
            autocomplete="off"
            [class.ng-invalid]="editForm.get('firstName')?.invalid && editForm.get('firstName')?.touched" />
          @if (editForm.get('firstName')?.invalid && editForm.get('firstName')?.touched) {
            @if (editForm.get('firstName')?.errors?.required) {
              <small class="p-error" jhiTranslate="entity.validation.required">Ce champ est obligatoire</small>
            }
          }
        </div>

        <!-- Prénom(s) -->
        <div class="form-field form-field-full">
          <label for="field_lastName">Prénom(s) <span class="required">*</span></label>
          <input
            pInputText
            id="field_lastName"
            formControlName="lastName"
            class="w-full"
            autocomplete="off"
            [class.ng-invalid]="editForm.get('lastName')?.invalid && editForm.get('lastName')?.touched" />
          @if (editForm.get('lastName')?.invalid && editForm.get('lastName')?.touched) {
            @if (editForm.get('lastName')?.errors?.required) {
              <small class="p-error" jhiTranslate="entity.validation.required">Ce champ est obligatoire</small>
            }
          }
        </div>
        <!-- Tiers Payant -->
        <div class="form-field form-field-full">
          <label for="tiersPayantId">Tiers payant <span class="required">*</span></label>
          <p-autoComplete
            id="tiersPayantId"
            formControlName="tiersPayantId"
            [suggestions]="tiersPayants"
            (completeMethod)="searchTiersPayant($event)"
            (onSelect)="onSelectTiersPayant($event)"
            [forceSelection]="true"
            [minQueryLength]="minLength"
            [dropdown]="true"
            optionLabel="fullName"
            placeholder="Taper pour rechercher"
            [fluid]="true">
          </p-autoComplete>
          @if (editForm.get('tiersPayantId')?.invalid && editForm.get('tiersPayantId')?.touched) {
            @if (editForm.get('tiersPayantId')?.errors?.required) {
              <small class="p-error" jhiTranslate="entity.validation.required">Ce champ est obligatoire</small>
            }
          }
        </div>
        <!-- Numéro de sécurité -->
        <div class="form-field form-field-full">
          <label for="field_num">Numéro de sécurité <span class="required">*</span></label>
          <input
            pInputText
            pKeyFilter="alphanum"
            id="field_num"
            formControlName="num"
            class="w-full"
            autocomplete="off"
            [class.ng-invalid]="editForm.get('num')?.invalid && editForm.get('num')?.touched" />
          @if (editForm.get('num')?.invalid && editForm.get('num')?.touched) {
            @if (editForm.get('num')?.errors?.required) {
              <small class="p-error" jhiTranslate="entity.validation.required">Ce champ est obligatoire</small>
            }
          }
        </div>



        <!-- Taux -->
        <div class="form-field form-field-full">
          <label for="field_taux">Taux (%) <span class="required">*</span></label>
          <input
            pInputText
            pKeyFilter="int"
            id="field_taux"
            formControlName="taux"
            class="w-full"
            autocomplete="off"
            [class.ng-invalid]="editForm.get('taux')?.invalid && editForm.get('taux')?.touched" />
          @if (editForm.get('taux')?.invalid && editForm.get('taux')?.touched) {
            @if (editForm.get('taux')?.errors?.required) {
              <small class="p-error">Ce champ est obligatoire</small>
            }
            @if (editForm.get('taux')?.errors?.min || editForm.get('taux')?.errors?.max) {
              <small class="p-error">Le taux doit être entre 0 et 100</small>
            }
          }
        </div>
      </div>
    </p-card>

    <!-- Section 2: Informations Complémentaires -->
    <p-card>
      <ng-template #header>
        <div class="section-header">
          <i class="pi pi-user"></i>
          <span>Informations Complémentaires</span>
        </div>
      </ng-template>

      <div class="form-grid-compact">
        <!-- Téléphone -->
        <div class="form-field form-field-full">
          <label for="field_phone">Téléphone</label>
          <input
            pInputText
            pKeyFilter="int"
            id="field_phone"
            formControlName="phone"
            type="tel"
            class="w-full"
            autocomplete="off" />
        </div>

        <!-- Email -->
        <div class="form-field form-field-full">
          <label for="email">E-mail</label>
          <input
            pInputText
            id="email"
            formControlName="email"
            type="email"
            class="w-full"
            autocomplete="off" />
        </div>

        <!-- Date de naissance -->
        <div class="form-field form-field-full">
          @let datNaiss = editForm.get('datNaiss');
          <label for="field_datNaiss">Date de naissance</label>
          <input
            pInputText
            jhiDateNaiss
            id="field_datNaiss"
            formControlName="datNaiss"
            placeholder="jj/mm/aaaa"
            class="w-full"
            [class.ng-invalid]="datNaiss?.invalid && datNaiss?.touched" />
          @if (datNaiss?.invalid && datNaiss?.touched) {
            @let errors = datNaiss?.errors;
            @if (errors?.invalidDate || errors?.outOfRange) {
              <small class="p-error">Veuillez saisir une date valide</small>
            }
          }
        </div>

        <!-- Sexe -->
        <div class="form-field form-field-full">
          <label>Sexe</label>
          <div class="radio-group">
            <p-radioButton formControlName="sexe" id="masculin" inputId="masculin" name="sexe" value="M"></p-radioButton>
            <label for="masculin" class="radio-label">Masculin</label>
            <p-radioButton formControlName="sexe" id="feminin" inputId="feminin" name="sexe" value="F"></p-radioButton>
            <label for="feminin" class="radio-label">Feminin</label>
          </div>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Section 3: Assurances Complémentaires -->
  @if (editForm.valid) {
    <div class="mt-2">
      <jhi-complementaire-step #complementaireStep />
    </div>
  }
</form>
