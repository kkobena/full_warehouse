<form (ngSubmit)="save()" [formGroup]="reglementForm">
  <div class="row mb-2">
    <div class=" col-4 col-sm-12 col-md-4 d-flex align-items-center">
      <p-toggleswitch formControlName="partialPayment" inputId="partialPayment"></p-toggleswitch>
      <label class="ms-2 fw-bold" for="partialPayment">Tout régler</label>
    </div>

    <div class="col-8 col-sm-12 col-md-8 ">
      <p-inputgroup>
        <p-inputgroup-addon>
          Date
        </p-inputgroup-addon>
        <p-datePicker
          [defaultDate]="maxDate"
          [maxDate]="maxDate"
          [showButtonBar]="true"
          appendTo="body"
          dateFormat="dd/mm/yy"
          formControlName="paymentDate"
          id="datePaiement"
          selectOtherMonths="true"
        />
      </p-inputgroup>


    </div>
  </div>

  <div class="mb-2">

    <p-inputgroup>
      <p-inputgroup-addon>Mode de paiement</p-inputgroup-addon>
      <p-select
        [fluid]="true"
        [options]="paymentModes"
        dataKey="code"
        formControlName="modePaimentCode"
        optionLabel="libelle"
        optionValue="code"
        size="large"
      >
      </p-select>
    </p-inputgroup>

  </div>
  <div class="mb-2">
    <p-inputgroup>
      <p-inputgroup-addon>Montant</p-inputgroup-addon>
      <input [fluid]="true" [readonly]="isReadOnly" formControlName="amount" pInputText
             pKeyFilter="int"
             size="large" />
    </p-inputgroup>

  </div>
  @if (showBanqueInfo) {
    <div formGroupName="banqueInfo">
      <p-divider align="center" type="solid">
        <b>Infos sur la banque</b>
      </p-divider>


      <div class="mb-1">
        <p-inputgroup>
          <p-inputgroup-addon>Nom <span style="color: red">*</span></p-inputgroup-addon>
          <input [fluid]="true" formControlName="nom" pInputText
                 size="large" />
        </p-inputgroup>
      </div>
      @if (reglementForm.get('banqueInfo').get('nom')!.invalid &&
      (reglementForm.get('banqueInfo').get('nom')!.dirty || reglementForm.get('banqueInfo').get(
        'nom')!.touched)) {
        <div>
          @if (reglementForm.get('banqueInfo').get('nom')?.errors?.required) {
            <small class="form-text text-danger" style="color: red"> Ce champ est
              obligatoire. </small>
          }
        </div>
      }

      @if (reglementForm.get('modePaimentCode')!.value === CH) {
        <div class="mb-1">

          <p-inputgroup>
            <p-inputgroup-addon>Numéro <span style="color: red">*</span></p-inputgroup-addon>
            <input [fluid]="true" formControlName="code" pInputText pKeyFilter="alphanum"
                   size="large" />
          </p-inputgroup>

        </div>
        @if (reglementForm.get('banqueInfo').get('code')!.invalid &&
        (reglementForm.get('banqueInfo').get('code')!.dirty || reglementForm.get(
          'banqueInfo').get(
          'code')!.touched)) {
          <div>
            @if (reglementForm.get('banqueInfo').get('code')?.errors?.required) {
              <small class="form-text text-danger" style="color: red"> Ce champ est
                obligatoire. </small>
            }
          </div>
        }
      }

      <div class="mb-2">
        <p-inputgroup>
          <p-inputgroup-addon>Bénéficiare</p-inputgroup-addon>
          <input [fluid]="true" formControlName="beneficiaire" pInputText
                 size="large" />
        </p-inputgroup>

      </div>
    </div>
  }
  <div class="d-flex justify-content-end">
    <p-button [disabled]="!valid || !validMontantSaisi() || isSaving()" [loading]="isSaving()"
              icon="pi pi-check" label="Valider"
              loadingIcon="pi pi-spinner" severity="danger" type="submit">

    </p-button>
  </div>
</form>


