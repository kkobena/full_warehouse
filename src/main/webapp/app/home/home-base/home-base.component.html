<div class="row mb-1">
  <div class="col-12 d-flex justify-content-end">
    <p-toggleButton
      (onChange)="onToggleChange($event)"
      [(ngModel)]="showGraphs"
      [style]="{ 'min-width': '10rem' }"
      offIcon="pi pi-table"
      offLabel="Vue Tabulaire"
      onIcon="pi pi-chart-bar"
      onLabel="Vue Graphique"
    ></p-toggleButton>
  </div>
</div>
<div class="row">
  <!-- Card 1: Total Montant Global -->
  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card h-100 border-start border-primary border-4">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="flex-grow-1">
            <p class="text-muted fw-medium mb-2">Total montant global</p>
            <h4 class="mb-0 "><span
              class="fw-semibold">{{ venteRecord?.salesAmount | number }} </span><span
              class="text-muted">TTC</span>
            </h4>
            <div class="mt-2 pt-1">
              <span
                class="badge bg-success-subtle fw-semibold text-success my-1 me-1 ">{{ venteRecord?.htAmount | number }}
                HT</span>
              <span
                class="badge bg-info-subtle fw-semibold text-info">{{ venteRecord?.taxAmount | number }}
                TVA</span>
            </div>
          </div>
          <div class="flex-shrink-0 text-primary">
            <fa-icon [icon]="faShoppingBasket" size="3x"></fa-icon>
          </div>
        </div>
      </div>
      <div class="card-footer bg-transparent border-top">
        <div class="d-flex justify-content-between align-items-center">
          <span class="text-muted">Nombre de ventes</span>
          <span
            class="badge bg-warning-subtle fw-semibold text-warning">{{ venteRecord?.saleCount | number }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Card 2: Total en Net -->
  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card h-100 border-start border-danger border-4">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="flex-grow-1">
            <p class="text-muted fw-medium mb-2">Total en net</p>
            <h4 class="mb-0 fw-semibold">{{ venteRecord?.netAmount | number }}</h4>
            <div class="mt-2 pt-1">
              <span
                class="badge bg-primary-subtle fw-semibold text-primary my-1 me-1">{{ venteRecord?.paidAmount | number }}
                Comptant</span>
              <span
                class="badge bg-danger-subtle  fw-semibold text-danger">{{ venteRecord?.restToPay | number }}
                Crédit</span>
            </div>
          </div>
          <div class="flex-shrink-0 text-danger">
            <fa-icon [icon]="faShippingFast" size="3x"></fa-icon>
          </div>
        </div>
      </div>
      <div class="card-footer bg-transparent border-top">
        <div class="d-flex justify-content-between align-items-center">
          <span class="text-muted">Remise</span>
          <span
            class="badge bg-primary-subtle fw-semibold text-primary  ">{{ venteRecord?.discountAmount | number }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Card 3: Chiffres d'affaires par type -->
  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card h-100 border-start border-success border-4">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="flex-grow-1">
            <p class="text-muted fw-medium mb-2">Chiffres d'affaires par type</p>
            <h4 class="mb-0 fw-semibold">{{
                (vno?.salesAmount || 0) + (assurance?.salesAmount || 0) | number
              }}</h4>
            <div class="mt-2 pt-1">
              <span
                class="badge bg-primary-subtle fw-semibold text-primary my-1 me-1">{{ vno?.salesAmount | number }}
                Comptant</span>
              <span
                class="badge bg-danger-subtle fw-semibold text-danger">{{ assurance?.salesAmount | number }}
                Crédit</span>
            </div>
          </div>
          <div class="flex-shrink-0 text-success">
            <fa-icon [icon]="faChartLine" size="3x"></fa-icon>
          </div>
        </div>
      </div>
      <div class="card-footer bg-transparent border-top">
        <div class="d-flex justify-content-between align-items-center">
          <span class="text-muted">Annulations</span>
          @if (canceled?.salesAmount) {
            <span
              class="badge bg-secondary-subtle text-secondary fw-semibold ">{{ canceled?.salesAmount | number }}
              ({{ canceled?.saleCount | number }})
            </span>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Card 4: Total Achats -->
  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card h-100 border-start border-warning border-4">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="flex-grow-1">
            <p class="text-muted fw-medium mb-2">Total montant des achats</p>
            <h4 class="mb-0"><span
              class="fw-semibold">{{ achatRecord?.receiptAmount | number }}</span> <span
              class="text-muted ">TTC</span></h4>
            <div class="mt-2 pt-1">
              <span
                class="badge bg-success-subtle fw-semibold text-success my-1 me-1 fw-semibold">{{ achatRecord?.netAmount | number }}
                HT</span>
              <span
                class="badge bg-info-subtle fw-semibold text-info fw-semibold">{{ achatRecord?.taxAmount | number }}
                TVA</span>
            </div>
          </div>
          <div class="flex-shrink-0 text-warning">
            <fa-icon [icon]="faCommentsDollar" size="3x"></fa-icon>
          </div>
        </div>
      </div>
      <div class="card-footer bg-transparent border-top">
        <div class="d-flex justify-content-between align-items-center">
          <span class="text-muted">Nombre d'achats</span>
          <span
            class="badge bg-warning-subtle text-warning fw-semibold  fw-semibold">{{ achatRecord?.achatCount | number }}</span>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- Card 5: Total par mode reglement -->
  <div class="col-xl-6 col-md-6 mb-2">
    <div class="card h-100">
      <div class="card-header d-flex justify-content-between align-items-center bg-light">
        <h5 class="card-title mb-0">
          <fa-icon [icon]="faCreditCard" class="text-info"></fa-icon>
          Total par mode de règlement
        </h5>
      </div>
      <div class="card-body py-4">
        @if (!showGraphs) {
          <ul class="list-group list-group-flush">
            @for (mode of venteModePaiments; track mode.libelle) {
              <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                {{ mode.libelle }}
                <span class="fw-semibold text-primary fs-6">{{ mode?.paidAmount | number }}</span>
              </li>
            }
          </ul>
        } @else {

          <div class="d-flex justify-content-center align-items-center h-100">
            <p-chart type="pie" [data]="modePaimentChartData" [options]="modePaimentChartOptions"
                     height="300"></p-chart>
          </div>
        }
      </div>
    </div>
  </div>
  <!-- Card 6: Ventes par tiers-payant -->
  <div class="col-xl-6 col-md-6 mb-2">
    <div class="card h-100">
      <div class="card-header d-flex justify-content-between align-items-center bg-light">
        <h5 class="card-title mb-0">
          <fa-icon [icon]="faChartPie" class="text-success"></fa-icon>
          Ventes par tiers-payant
        </h5>
        <p-select (onChange)="onTopTiersPayantChange()" [(ngModel)]="TOP_MAX_TP" [options]="tops"
                  optionLabel="label"></p-select>
      </div>
      <div class="card-body py-4">
        @if (!showGraphs) {
          <ul class="list-group list-group-flush">
            @for (tp of tiersPayantAchat; track tp.tiersPayantName) {
              <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                {{ tp.tiersPayantName }}
                <span class="fw-semibold text-success fs-6">{{ tp?.montantTtc | number }}</span>
              </li>
            }
          </ul>
        } @else {
          <div class="d-flex justify-content-center align-items-center h-100">
            <p-chart type="doughnut" [data]="tiersPayantChartData"
                     [options]="tiersPayantChartOptions" height="300"></p-chart>
          </div>
        }
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-lg-6 mb-2">
    <div class="card h-100">
      <div class="card-header d-flex justify-content-between align-items-center bg-light">
        <h5 class="card-title mb-0">
          <fa-icon [icon]="faChartArea" class="text-primary"></fa-icon>
          Meilleures ventes en quantité
        </h5>
        <p-select (onChange)="onTopQuantityChange()" [(ngModel)]="TOP_MAX_QUANTITY"
                  [options]="tops" optionLabel="label"></p-select>
      </div>
      <div class="card-body p-0">
        @if (!showGraphs) {
          <p-table [scrollable]="true" [value]="rowQuantity" scrollHeight="400px"
                   styleClass="p-table-striped">
            <ng-template #header>
              <tr>
                <th>Libellé</th>
                <th class="text-end">Montant</th>
                <th class="text-end">Quantité</th>
              </tr>
            </ng-template>
            <ng-template #body let-produit>
              <tr>
                <td>{{ produit.libelle }}</td>
                <td class="text-end">{{ produit.htAmount | number }}</td>
                <td class="text-end fw-bold text-primary">{{ produit.quantitySold | number }}</td>
              </tr>
            </ng-template>
            <ng-template #footer>
              <tr>
                <td class="fw-bold">Total</td>
                <td class="text-end fw-bold">{{ totalAmountTopQuantity | number }}</td>
                <td class="text-end fw-bold">{{ totalQuantityToQuantity | number }}</td>
              </tr>
            </ng-template>
          </p-table>
        } @else {
          <div class="p-3">
            <p-chart type="bar" [data]="quantityChartData" [options]="quantityChartOptions"
                     height="400px"></p-chart>
          </div>
        }
      </div>
    </div>
  </div>

  <div class="col-lg-6 mb-2">
    <div class="card h-100">
      <div class="card-header d-flex justify-content-between align-items-center bg-light">
        <h5 class="card-title mb-0">
          <fa-icon [icon]="faChartBar" class="text-warning"></fa-icon>
          Meilleures ventes en valeur
        </h5>
        <p-select (onChange)="onTopAmountChange()" [(ngModel)]="TOP_MAX_AMOUNT" [options]="tops"
                  optionLabel="label"></p-select>
      </div>
      <div class="card-body p-0">
        @if (!showGraphs) {
          <p-table [scrollable]="true" [value]="rowAmount" scrollHeight="400px"
                   styleClass="p-table-striped">
            <ng-template #header>
              <tr>
                <th>Libellé</th>
                <th class="text-end">Quantité</th>
                <th class="text-end">Montant</th>
              </tr>
            </ng-template>
            <ng-template #body let-produit>
              <tr>
                <td>{{ produit.libelle }}</td>
                <td class="text-end">{{ produit.quantitySold | number }}</td>
                <td class="text-end fw-bold text-warning">{{ produit.htAmount | number }}</td>
              </tr>
            </ng-template>
            <ng-template #footer>
              <tr>
                <td class="fw-bold">Total</td>
                <td class="text-end fw-bold">{{ totalQuantityTopAmount | number }}</td>
                <td class="text-end fw-bold">{{ totalAmountTopAmount | number }}</td>
              </tr>
            </ng-template>
          </p-table>
        } @else {
          <div class="p-3">
            <p-chart type="bar" [data]="amountChartData" [options]="amountChartOptions"
                     height="400px"></p-chart>
          </div>
        }
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-12 mb-2">
    <div class="card h-100">
      <div class="card-header d-flex justify-content-between align-items-center bg-light">
        <h5 class="card-title mb-0">
          <fa-icon [icon]="faChartLine" class="text-info"></fa-icon>
          Analyse 20/80 du chiffre d'affaire
        </h5>
      </div>
      <div class="card-body p-0">
        @if (!showGraphs) {
          <p-table [scrollable]="true" [value]="row20x80" scrollHeight="400px"
                   styleClass="p-table-striped">
            <ng-template #header>
              <tr>
                <th>Libellé</th>
                <th class="text-end">Quantité</th>
                <th class="text-end">% Qté</th>
                <th class="text-end">Montant</th>
                <th class="text-end">% Montant</th>
              </tr>
            </ng-template>
            <ng-template #body let-produit>
              <tr>
                <td>{{ produit.libelle }}</td>
                <td class="text-end">{{ produit.quantitySold | number }}</td>
                <td class="text-end fw-bold text-info">{{ produit.quantityAvg }}</td>
                <td class="text-end">{{ produit.htAmount | number }}</td>
                <td class="text-end fw-bold text-info">{{ produit.amountAvg }}</td>
              </tr>
            </ng-template>
            <ng-template #footer>
              <tr>
                <td class="fw-bold">Total</td>
                <td class="text-end fw-bold">{{ totalQuantity20x80 | number }}</td>
                <td class="text-end fw-bold">{{ totalQuantityAvg | number }}</td>
                <td class="text-end fw-bold">{{ totalAmount20x80 | number }}</td>
                <td class="text-end fw-bold">{{ totalAmountAvg | number }}</td>
              </tr>
            </ng-template>
          </p-table>
        } @else {
          <div class="p-3">
            <p-chart type="bar" [data]="twentyEightyChartData" [options]="twentyEightyChartOptions"
                     height="400px"></p-chart>
          </div>
        }
      </div>
    </div>
  </div>
</div>
