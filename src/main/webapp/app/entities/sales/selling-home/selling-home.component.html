<p-drawer [(visible)]="pendingSalesSidebar" [style]="{ width: '70vw' }" position="right">
  <ng-template #header>
    <span class="font-semibold text-xl">VENTES EN ATTENTES</span>
  </ng-template>
  <ng-template #content>
    <jhi-prevente-modal (pendingSalesSidebarChange)="closeSideBar($event)"
                        [user]="userCaissier"></jhi-prevente-modal>
  </ng-template>
</p-drawer>
<div class="container-fluid">
  <div class="row ">
    <div class="col-lg-2 col-xl-2 col-md-2 col-sm-2">

      <p-card header="SÃ©lectionner le type de vente">
        <div
          #nav="ngbNav"
          (navChange)="onNavChange($event)"
          [(activeId)]="active"
          class="nav flex-column nav-pills"
          ngbNav
          orientation="vertical"
        >
          <ng-container ngbNavItem="comptant">
            <a class="flex-sm-fill nav-link" ngbNavLink>Comptant</a>
            <ng-template ngbNavContent>
              <jhi-comptant
                (inputToFocusEvent)="getControlToFocus($event)"
                (responseEvent)="onFinalyse($event)"
                (saveResponse)="onSave($event)"
                [canFocusLastModeInput]="canFocusLastModeInput"
                [isPresale]="isPresale"
              >
              </jhi-comptant>
            </ng-template>
          </ng-container>
          <p-divider layout="horizontal"></p-divider>
          <ng-container ngbNavItem="assurance">
            <a class="flex-sm-fill nav-link" ngbNavLink>Assurance</a>
            <ng-template ngbNavContent>
              <jhi-assurance [isPresale]="isPresale"></jhi-assurance>
            </ng-template>
          </ng-container>
          <p-divider layout="horizontal"></p-divider>
          <ng-container ngbNavItem="carnet">
            <a class="flex-sm-fill nav-link" ngbNavLink>Carnet</a>
            <ng-template ngbNavContent>
              <jhi-carnet [isPresale]="isPresale"></jhi-carnet>
            </ng-template>
          </ng-container>
        </div>
      </p-card>


    </div>
    <div class="col-lg-10 col-xl-10   col-md-10 col-sm-10 ">
      <p-toolbar styleClass="mb-1">
        <div [style]="{ width: '100%'}" class="row ">
          <div class="col-3 ">
            <p-floatlabel variant="on">
              <p-select
                #userBox
                (onChange)="onSelectUser()"
                [(ngModel)]="userSeller"
                [appendTo]="appendTo"
                [autofocus]="true"
                [dataKey]="'id'"
                [fluid]="true"
                [options]="this.userVendeurService.vendeurs()"
                id="vendeurs"
                optionLabel="abbrName"
                size="large"
              ></p-select>

              <label for="vendeurs">{{ 'warehouseApp.sales.vendeurs' | translate }}</label>
            </p-floatlabel>
          </div>
          <div class="col-9 row text-right" style="padding: 0">
            <div class="col-8">
              @if (active === 'comptant' && currentSaleService.currentSale()) {
                <jhi-customer-overlay-panel
                  (onCloseEvent)="onCustomerOverlay($event)"></jhi-customer-overlay-panel>
              }
            </div>
            <div class="col-4">
              @if (isLargeScreen) {
                <p-button
                  (click)="openPindingSide()"
                  [disabled]="currentSaleService.currentSale() || isPresale"
                  [raised]="true"
                  icon="pi pi-search"
                  label="Ventes en attente"
                  severity="info"
                ></p-button>
              } @else {
                <p-button
                  (click)="openPindingSide()"
                  [disabled]="currentSaleService.currentSale() || isPresale"
                  [raised]="true"
                  icon="pi pi-search"
                  pTooltip="Ventes en attente"
                  severity="info"
                  tooltipPosition="left"
                ></p-button>
              }

              <p-button (click)="previousState()" [raised]="true" icon="pi pi-arrow-left"
                        label="Retour" severity="secondary"></p-button>
            </div>
          </div>
        </div>
      </p-toolbar>

      @if (active === 'assurance' || active === 'carnet') {
        <p-toolbar styleClass="mt-1">
          <jhi-assurance-data></jhi-assurance-data>
        </p-toolbar>
      }

      <p-toolbar styleClass="mt-2 mb-2">
        <div [style]="{ width: '100%'}" class="row mt-sm-1">
          <div class="col-md-6 sale-product-div d-flex justify-content-between">
            <div class="flex-grow-1 mr-1">
              <jhi-produit-autocomplete #produitbox
                                        (onKeyEnter)="onSaveKeyDown($event)"
                                        (selectedProduit)="onSelectProduct($event)"
                                        [(ngModel)]="produitSelected"
                                        [autofocus]="true"
                                        [includeDetails]="true"
                                        [pageSize]="PRODUIT_COMBO_RESULT_SIZE">
              </jhi-produit-autocomplete>
            </div>
            <div>
              <jhi-quantite-produt-saisie #produitQteCmpt (addQuantite)="addQuantity($event)"
                                          [disabledButton]="disableButton"
                                          [isValid]="!!produitSelected"
                                          [style]="{'max-width': '160px'}">
              </jhi-quantite-produt-saisie>

            </div>

          </div>

          @if (showStock) {
            <div class="col-md-1">
              <p-button
                badgeSeverity="contrast"
                label="Stock"
                outlined
                [badge]="produitSelected?.totalQuantity | number"
              ></p-button>
            </div>
          }
          <div class="col-md-3">
            @for (rayon of produitSelected?.rayonProduits; track rayon.id) {
              <p-button badgeSeverity="contrast" label="Rayons" outlined
                        [badge]="rayon.libelleRayon"></p-button>
            }
          </div>
        </div>
      </p-toolbar>
      <div [ngbNavOutlet]="nav" class="row"></div>
      <!--  <p-card>
          <ng-template #content>
            <div class="sale-body0">

              <div [ngbNavOutlet]="nav" class="row sale-tab-container"></div>
            </div>
          </ng-template>
        </p-card>-->
    </div>
  </div>
</div>


<jhi-confirm-dialog #confirmDialog></jhi-confirm-dialog>
<jhi-toast-alert #alert></jhi-toast-alert>

