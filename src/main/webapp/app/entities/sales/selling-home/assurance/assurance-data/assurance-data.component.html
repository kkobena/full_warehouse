<div [style]="{ width: '100%'}" class="row pharma-toolbar-row">
  <div class="col-xl-2 col-lg-2 col-md-2 col-sm-12 ">
    @if (selectedCustomerService.selectedCustomerSignal() && currentSaleService.currentSale()) {
      <p-button (click)="onChangeCustomerClick()" [variant]="'text'" icon="pi pi-user-edit"
                label="Changer de client"
                raised="true" severity="danger"
      >
      </p-button>
    } @else {
      <p-iconfield>
        <p-inputicon class="pi pi-search" />
        <input
          #searchInput
          (keydown.enter)="load()"
          [(ngModel)]="search"
          [style]="{ width: '98%' }"
          autocomplete="off"
          class="form-control-lg"
          pInputText
          [fluid]="true"
          placeholder="Rechercher client"
          type="text"
        />
      </p-iconfield>
    }
  </div>
  @if (selectedCustomerService.selectedCustomerSignal()) {
    <div class="col-xl-10 col-lg-10 col-md-10 col-sm-12 row">
      <div [class]="divCustomer()">
        <ul class="list-group list-group-flush">
          <li
            class="list-group-item d-flex justify-content-between align-items-center bg-primary-subtle">
            <span>Assuré</span>
            <p-button (click)="editAssuredCustomer()" [variant]="'text'" icon="pi pi-user-edit"
                      label="Editer" raised="true" severity="info"

                      size="small"
            />
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            Nom/Prénom(s)
            <span class="badge bg-secondary"
            >{{ selectedCustomerService.selectedCustomerSignal().firstName }}
              {{ selectedCustomerService.selectedCustomerSignal().lastName }}</span
            >
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            Matricule
            <span
              class="badge bg-secondary">{{ selectedCustomerService.selectedCustomerSignal().num }}</span>
          </li>
        </ul>
      </div>
      @if (currentSaleService.typeVo() === 'ASSURANCE') {

        <div [class]="divCustomer()">
          <ul class="list-group list-group-flush">
            <li
              aria-current="true"
              class="list-group-item d-flex justify-content-between align-items-center list-group-title bg-success bg-opacity-10"
            >
              <span>Ayant droit</span>
              @if (ayantDroit?.id === selectedCustomerService.selectedCustomerSignal().id) {
                <p-button (click)="loadAyantDoits()" [variant]="'text'" icon="pi pi-users"
                          label="Remplacer" raised="true"
                          size="small"
                />

              } @else {
                <p-splitbutton [model]="items" [text]="true" icon="pi pi-user-edit"
                               label="Gérer" severity="info" size="small" />
              }
            </li>
            @if (ayantDroit) {
              <li class="list-group-item d-flex justify-content-between align-items-center">
                Nom/Prénom(s)
                <span
                  class="badge bg-secondary">{{ ayantDroit.firstName }} {{ ayantDroit.lastName }}</span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                Matricule
                <span class="badge bg-secondary">{{ ayantDroit.num }}</span>
              </li>
            }

          </ul>
        </div>

      }

      @for (tp of selectedTiersPayants(); track tp.id; let i = $index) {
        <div [class]="divClass()">
          <div class="row">
            <div class="col-8 fw-medium text-nowrap">
              @if (i === 0) {
                <span class="fw-semibold">RO:</span> <span>{{ tp.tiersPayantName }}</span>
              } @else {
                <span class="fw-semibold">RC{{ i }}:</span>
                <span>{{ tp.tiersPayantName }}</span>
              }
            </div>
            <div class="col-4 fw-medium text-end">
              Taux: <span class="red-400 fw-semibold">{{ tp.taux }}%</span>
            </div>
          </div>
          <div class="tp-input-container">
            <p-inputgroup>
              <p-inputgroup-addon>Bon</p-inputgroup-addon>
              <input
                #tpInput
                (keydown.enter)="onBonEnter(tp)"
                [(ngModel)]="tp.numBon"
                [fluid]="true"
                autocomplete="off"
                class="tiersPayant-input"
                id="bon-{{ tp.id }}"
                name="bon-{{ i }}"
                pInputText
                pKeyFilter="alphanum"
                type="text"
              />
              @if (selectedTiersPayants().length > 1) {
                <p-inputgroup-addon>
                  <p-button (click)="removeTiersPayant(tp)" icon="pi pi-trash" pTooltip="Supprimer ce tiers payant"
                            severity="danger"
                            type="button">
                  </p-button>
                </p-inputgroup-addon>
              }
              @if (selectedCustomerService.selectedCustomerSignal() && selectedTiersPayants().length
              < selectedCustomerService.selectedCustomerSignal().tiersPayants.length
              && currentSaleService.typeVo() === 'ASSURANCE') {
                <p-inputgroup-addon>
                  <p-button (click)="addComplementaire()"
                            icon="pi pi-plus"
                            pTooltip="Ajouter un tiers payant complémentaire" severity="primary"
                            type="button">
                  </p-button>
                </p-inputgroup-addon>
              }


            </p-inputgroup>
          </div>
        </div>
      }


    </div>
  }


</div>
<jhi-confirm-dialog #confirmDialog></jhi-confirm-dialog>


